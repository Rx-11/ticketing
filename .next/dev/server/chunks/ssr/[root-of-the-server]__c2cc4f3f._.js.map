{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20Folder/project/tartanhacks/ticketing/lib/stake.ts"],"sourcesContent":["// lib/stake.ts\r\nexport function requiredStakeXrp(score: number): string {\r\n  // Simple, obvious curve for demo:\r\n  // score 0 => 25 XRP\r\n  // score 80 => ~5 XRP\r\n  const maxStake = 25;\r\n  const minStake = 5;\r\n\r\n  const clamped = Math.max(0, Math.min(100, score));\r\n  const t = clamped / 100; // 0..1\r\n  const stake = maxStake - (maxStake - minStake) * t;\r\n\r\n  // keep nice formatting\r\n  return stake.toFixed(2).replace(/\\.?0+$/, \"\");\r\n}\r\n"],"names":[],"mappings":"AAAA,eAAe;;;;;AACR,SAAS,iBAAiB,KAAa;IAC5C,kCAAkC;IAClC,oBAAoB;IACpB,qBAAqB;IACrB,MAAM,WAAW;IACjB,MAAM,WAAW;IAEjB,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK;IAC1C,MAAM,IAAI,UAAU,KAAK,OAAO;IAChC,MAAM,QAAQ,WAAW,CAAC,WAAW,QAAQ,IAAI;IAEjD,uBAAuB;IACvB,OAAO,MAAM,OAAO,CAAC,GAAG,OAAO,CAAC,UAAU;AAC5C"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20Folder/project/tartanhacks/ticketing/lib/hash.ts"],"sourcesContent":["// lib/hash.ts\r\nexport async function sha256Hex(input: string): Promise<string> {\r\n  const enc = new TextEncoder();\r\n  const bytes = enc.encode(input);\r\n  const digest = await crypto.subtle.digest(\"SHA-256\", bytes);\r\n  return [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nexport function randomHex(bytes: number): string {\r\n  const arr = new Uint8Array(bytes);\r\n  crypto.getRandomValues(arr);\r\n  return [...arr].map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n"],"names":[],"mappings":"AAAA,cAAc;;;;;;;AACP,eAAe,UAAU,KAAa;IAC3C,MAAM,MAAM,IAAI;IAChB,MAAM,QAAQ,IAAI,MAAM,CAAC;IACzB,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACrD,OAAO;WAAI,IAAI,WAAW;KAAQ,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACpF;AAEO,SAAS,UAAU,KAAa;IACrC,MAAM,MAAM,IAAI,WAAW;IAC3B,OAAO,eAAe,CAAC;IACvB,OAAO;WAAI;KAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACjE"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20Folder/project/tartanhacks/ticketing/lib/xrplMemo.ts"],"sourcesContent":["// lib/xrplMemo.ts\r\nexport function utf8ToHex(str: string): string {\r\n  return Buffer.from(str, \"utf8\").toString(\"hex\").toUpperCase();\r\n}\r\n\r\nexport function makeCommitMemo(eventId: string, tierId: string, commitHash: string) {\r\n  // Keep it short. XRPL memos are hex strings.\r\n  const memoString = `COMMIT|${eventId}|${tierId}|${commitHash}`;\r\n  return {\r\n    Memo: {\r\n      MemoType: utf8ToHex(\"FEN\"),\r\n      MemoData: utf8ToHex(memoString),\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;;;AACX,SAAS,UAAU,GAAW;IACnC,OAAO,OAAO,IAAI,CAAC,KAAK,QAAQ,QAAQ,CAAC,OAAO,WAAW;AAC7D;AAEO,SAAS,eAAe,OAAe,EAAE,MAAc,EAAE,UAAkB;IAChF,6CAA6C;IAC7C,MAAM,aAAa,CAAC,OAAO,EAAE,QAAQ,CAAC,EAAE,OAAO,CAAC,EAAE,YAAY;IAC9D,OAAO;QACL,MAAM;YACJ,UAAU,UAAU;YACpB,UAAU,UAAU;QACtB;IACF;AACF"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///D:/New%20Folder/project/tartanhacks/ticketing/app/event/%5BeventId%5D/EventClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { requiredStakeXrp } from \"@/lib/stake\";\r\nimport { randomHex, sha256Hex } from \"@/lib/hash\";\r\nimport { makeCommitMemo } from \"@/lib/xrplMemo\";\r\nimport * as xrpl from \"xrpl\";\r\n\r\nexport default function EventClient({ eventId }: { eventId: string }) {\r\n  const [seed, setSeed] = useState(\"\");\r\n  const [walletAddr, setWalletAddr] = useState(\"\");\r\n  const [score, setScore] = useState<number | null>(null);\r\n  const [loadingScore, setLoadingScore] = useState(false);\r\n\r\n  const [status, setStatus] = useState<string>(\"\");\r\n  const [commitHash, setCommitHash] = useState<string>(\"\");\r\n  const [secret, setSecret] = useState<string>(\"\");\r\n  const [nonce, setNonce] = useState<string>(\"\");\r\n\r\n  const xrplWs = process.env.NEXT_PUBLIC_XRPL_WS!;\r\n  const platformAddr = process.env.NEXT_PUBLIC_PLATFORM_RECEIVE_ADDRESS!;\r\n\r\n  // Hardcode tier for MVP\r\n  const tierId = \"GA\";\r\n\r\n  // Derive wallet address from seed\r\n  useEffect(() => {\r\n    try {\r\n      if (!seed.trim()) {\r\n        setWalletAddr(\"\");\r\n        return;\r\n      }\r\n      const w = xrpl.Wallet.fromSeed(seed.trim());\r\n      setWalletAddr(w.classicAddress);\r\n    } catch {\r\n      setWalletAddr(\"\");\r\n    }\r\n  }, [seed]);\r\n\r\n  // Load score based on wallet address\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    async function load() {\r\n      if (!walletAddr) {\r\n        setScore(null);\r\n        return;\r\n      }\r\n      setLoadingScore(true);\r\n      try {\r\n        const res = await fetch(`/api/score?wallet=${encodeURIComponent(walletAddr)}`);\r\n        const data = await res.json();\r\n        if (!cancelled) setScore(data.score ?? 0);\r\n      } finally {\r\n        if (!cancelled) setLoadingScore(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { cancelled = true; };\r\n  }, [walletAddr]);\r\n\r\n  const stakeXrp = useMemo(() => (score === null ? null : requiredStakeXrp(score)), [score]);\r\n\r\n  async function doCommit() {\r\n    if (!seed.trim()) return setStatus(\"Enter a seed (testnet) to commit.\");\r\n    if (!walletAddr) return setStatus(\"Invalid seed.\");\r\n    if (!stakeXrp) return setStatus(\"Score not loaded yet.\");\r\n    if (!platformAddr?.startsWith(\"r\")) return setStatus(\"Set NEXT_PUBLIC_PLATFORM_RECEIVE_ADDRESS.\");\r\n\r\n    setStatus(\"Preparing commit…\");\r\n\r\n    // 1) Generate secret+nonce and commit hash\r\n    const sec = randomHex(16);\r\n    const non = randomHex(16);\r\n    const commitInput = `${eventId}|${tierId}|${walletAddr}|${sec}|${non}`;\r\n    const cHash = await sha256Hex(commitInput);\r\n\r\n    setSecret(sec);\r\n    setNonce(non);\r\n    setCommitHash(cHash);\r\n\r\n    // 2) Submit stake payment with memo\r\n    const client = new xrpl.Client(xrplWs);\r\n    try {\r\n      await client.connect();\r\n      const wallet = xrpl.Wallet.fromSeed(seed.trim());\r\n\r\n      const memo = makeCommitMemo(eventId, tierId, cHash);\r\n\r\n      const tx: xrpl.Payment = {\r\n        TransactionType: \"Payment\",\r\n        Account: wallet.classicAddress,\r\n        Destination: platformAddr,\r\n        Amount: xrpl.xrpToDrops(stakeXrp),\r\n        Memos: [memo],\r\n      };\r\n\r\n      setStatus(\"Submitting stake payment to XRPL…\");\r\n\r\n      const result = await client.submitAndWait(tx, { wallet });\r\n\r\n      const txHash =\r\n        (result.result as any)?.hash ||\r\n        (result.result as any)?.tx_json?.hash;\r\n\r\n      if (!txHash) {\r\n        console.error(result);\r\n        setStatus(\"Submitted, but couldn’t read tx hash. Check console.\");\r\n        return;\r\n      }\r\n\r\n      setStatus(`On-ledger commit tx confirmed: ${txHash}. Saving…`);\r\n\r\n      // 3) Store commit in backend\r\n      const saveRes = await fetch(\"/api/queue/commit\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          eventId,\r\n          tierId,\r\n          wallet: walletAddr,\r\n          stakeXrp,\r\n          commitHash: cHash,\r\n          commitTxHash: txHash,\r\n        }),\r\n      });\r\n\r\n      const saveJson = await saveRes.json();\r\n      if (!saveRes.ok) {\r\n        setStatus(`Commit saved failed: ${saveJson.error || \"unknown error\"}`);\r\n        return;\r\n      }\r\n\r\n      setStatus(\"✅ Commit complete (stake paid, memo on-chain, stored).\");\r\n    } catch (e: any) {\r\n      console.error(e);\r\n      setStatus(`Commit failed: ${e?.message || String(e)}`);\r\n    } finally {\r\n      try { await client.disconnect(); } catch {}\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <h2>Join Queue</h2>\r\n      <div style={{ opacity: 0.7, marginBottom: 10 }}>Event: {eventId} • Tier: {tierId}</div>\r\n\r\n      <div style={{ display: \"grid\", gap: 10, maxWidth: 720 }}>\r\n        <label>\r\n          Testnet seed (MVP/dev only):\r\n          <input\r\n            value={seed}\r\n            onChange={(e) => setSeed(e.target.value)}\r\n            placeholder=\"s████████████...\"\r\n            style={{ marginLeft: 8, width: \"100%\", padding: 8 }}\r\n          />\r\n        </label>\r\n\r\n        <div>\r\n          <b>Wallet:</b> {walletAddr || <span style={{ opacity: 0.6 }}>—</span>}\r\n        </div>\r\n\r\n        <div>\r\n          {loadingScore && <div>Loading score…</div>}\r\n          {!loadingScore && score !== null && (\r\n            <>\r\n              <div><b>FenScore:</b> {score}</div>\r\n              <div><b>Required stake:</b> {stakeXrp} XRP</div>\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        <button onClick={doCommit} style={{ padding: \"10px 12px\", width: 200 }}>\r\n          Commit (stake XRP)\r\n        </button>\r\n\r\n        {status && <div style={{ whiteSpace: \"pre-wrap\" }}>{status}</div>}\r\n\r\n        {commitHash && (\r\n          <div style={{ marginTop: 6 }}>\r\n            <div><b>CommitHash:</b> {commitHash}</div>\r\n            <div style={{ opacity: 0.7, fontSize: 12 }}>\r\n              (secret+nonce generated locally; keep them for reveal step)\r\n            </div>\r\n            <div style={{ opacity: 0.7, fontSize: 12 }}>\r\n              secret: {secret} • nonce: {nonce}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}